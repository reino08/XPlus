// ==UserScript==
// @name        X+ User Lists
// @namespace   X+
// @match       *://twitter.com/*
// @match       *://x.com/*
// @run-at      document-start
// @homepageURL https://github.com/reino08/XPlus
// @downloadURL https://reino08.github.io/XPlus/X+.userlists.user.js
// @grant       GM.xmlHttpRequest
// @grant       unsafeWindow
// ==/UserScript==
var t=[],e=[];!function(r,s){if(r&&"undefined"!=typeof document){var n,o=!0===s.prepend?"prepend":"append",i=!0===s.singleTag,a="string"==typeof s.container?document.querySelector(s.container):document.getElementsByTagName("head")[0];if(i){var f=t.indexOf(a);-1===f&&(f=t.push(a)-1,e[f]={}),n=e[f]&&e[f][o]?e[f][o]:e[f][o]=c()}else n=c();65279===r.charCodeAt(0)&&(r=r.substring(1)),n.styleSheet?n.styleSheet.cssText+=r:n.appendChild(document.createTextNode(r))}function c(){var t=document.createElement("style");if(t.setAttribute("type","text/css"),s.attributes)for(var e=Object.keys(s.attributes),r=0;r<e.length;r++)t.setAttribute(e[r],s.attributes[e[r]]);var n="prepend"===o?"afterbegin":"beforeend";return a.insertAdjacentElement(n,t),t}}("article:has(.xp-userlists-filter1):not(:has(.xp-quoted-post+.xp-userlists-filter1)){background-color:#ff000040}article:has(.xp-userlists-filter2):not(:has(.xp-quoted-post+.xp-userlists-filter2)){background:linear-gradient(#5ca0d240 0 12.5%,#9ed3df40 12.5% 25%,#f4f49340 25% 37.5%,#ffffff40 37.5% 62.5%,#f4f49340 62.5% 75%,#ffb8c540 75% 87.5%,#cc5d7e40 87.5% 100%)}.xp-quoted-post+.xp-userlists-filter1+*>*{background-color:#ff000040}.xp-quoted-post+.xp-userlists-filter2+*>*{background:linear-gradient(#5ca0d240 0 12.5%,#9ed3df40 12.5% 25%,#f4f49340 25% 37.5%,#ffffff40 37.5% 62.5%,#f4f49340 62.5% 75%,#ffb8c540 75% 87.5%,#cc5d7e40 87.5% 100%)}.xp-quoted-post+:not(.xp-userlists-filter1)>*,.xp-quoted-post+:not(.xp-userlists-filter2)>*{background-color:#000}",{});function r(t,e){var r;"number"!=typeof t&&(t=32*(r=t).length);var s=Math.ceil(t/32),n=-1;if(this.m=t=32*s,this.k=e,this.buckets=[],r)for(;++n<s;)this.buckets[n]=r[n];else for(;++n<s;)this.buckets[n]=0;this._locations=[]}function s(t){return 16843009*((t=(858993459&(t-=t>>1&1431655765))+(t>>2&858993459))+(t>>4)&252645135)>>24}function n(t,e){for(var r=2166136261^(e||0),s=0,n=t.length;s<n;++s){var i=t.charCodeAt(s),a=65280&i;a&&(r=o(r^a>>8)),r=o(r^255&i)}return function(t){return t+=t<<13,t^=t>>>7,t+=t<<3,t^=t>>>17,t+=t<<5,4294967295&t}(r)}function o(t){return t+(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24)}r.prototype.locations=function(t){for(var e=this.k,r=this.m,s=this._locations,o=n(t),i=n(t,1576284489),a=o%r,f=0;f<e;++f)s[f]=a<0?a+r:a,a=(a+i)%r;return s},r.prototype.add=function(t){for(var e=this.locations(t+""),r=this.k,s=this.buckets,n=0;n<r;++n)s[Math.floor(e[n]/32)]|=1<<e[n]%32},r.prototype.test=function(t){for(var e=this.locations(t+""),r=this.k,s=this.buckets,n=0;n<r;++n){var o=e[n];if(!(s[Math.floor(o/32)]&1<<o%32))return!1}return!0},r.prototype.size=function(){for(var t=this.buckets,e=0,r=0,n=t.length;r<n;++r)e+=s(t[r]);return-this.m*Math.log(1-e/this.m)/this.k};const[i,a]=["https://github.com/shinigami-eyes/dynamic-filters/raw/refs/heads/main/bloomfilters/bloomfilter_24121100_transphobic.dat","https://github.com/shinigami-eyes/dynamic-filters/raw/refs/heads/main/bloomfilters/bloomfilter_24121100_tfriendly.dat"].map((t=>GM.xmlHttpRequest({url:t,responseType:"arraybuffer"}).then((t=>[new r(new Int32Array(t.response.slice(0,287552)),20),new r(new Int32Array(t.response.slice(287552)),21)]))));var f;f=async t=>{const[e,r]=await i,[s,n]=await a;function o(o){if(!o?.user)return[null,null];const i="twitter.com/"+o.user.screen_name.toLowerCase();return[e.test(i)||r.test(i+"|1")?t.React.createElement("span",{className:"xp-userlists-filter1"}):null,s.test(i)||n.test(i+"|1")?t.React.createElement("span",{className:"xp-userlists-filter2"}):null]}t.patches.QuotedPostPatch.then((e=>e.subscribe(e.post,((e,[r],s)=>[[...o(r.tweet),...t.React.Children.toArray(s)]]),-50))),t.patches.TweetUserPatch.then((e=>e.subscribe(e.post,((e,r,s)=>{s.props.children=[...o(e.props.tweet),...t.React.Children.toArray(s.props.children)]}),-200)))},(unsafeWindow[Symbol.for("X+ Addons 0")]||=[]).push(f);
