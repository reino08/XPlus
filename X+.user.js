// ==UserScript==
// @name        X+
// @namespace   X+
// @match       *://twitter.com/*
// @match       *://x.com/*
// @run-at      document-start
// @require     https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js
// @require     https://cdn.jsdelivr.net/npm/dayjs@1/plugin/relativeTime.js
// @homepageURL https://github.com/reino08/XPlus
// @downloadURL https://reino08.github.io/XPlus/X+.user.js
// @grant       GM.getValue
// @grant       GM.setValue
// @grant       GM_addElement
// @grant       unsafeWindow
// ==/UserScript==
var e=[],t=[];!function(r,n){if(r&&"undefined"!=typeof document){var o,i=!0===n.prepend?"prepend":"append",s=!0===n.singleTag,l="string"==typeof n.container?document.querySelector(n.container):document.getElementsByTagName("head")[0];if(s){var a=e.indexOf(l);-1===a&&(a=e.push(l)-1,t[a]={}),o=t[a]&&t[a][i]?t[a][i]:t[a][i]=p()}else o=p();65279===r.charCodeAt(0)&&(r=r.substring(1)),o.styleSheet?o.styleSheet.cssText+=r:o.appendChild(document.createTextNode(r))}function p(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),n.attributes)for(var t=Object.keys(n.attributes),r=0;r<t.length;r++)e.setAttribute(t[r],n.attributes[t[r]]);var o="prepend"===i?"afterbegin":"beforeend";return l.insertAdjacentElement(o,e),e}}('.xp-userinfo-container{display:flex;flex-wrap:wrap;width:fit-content}.xp-userinfo-child{background-color:#202327;border-radius:4px;font-family:TwitterChirp;font-size:11px;margin-left:4px;padding:2px 4px;text-decoration:none}.xp-rich-text-editor{line-height:0px}.xp-rich-text-editor>button{background-color:transparent;border:1px solid #444;font-size:14px;margin-right:2px;padding:0 2px}.xp-quote-count{color:#71767b;flex:1;font-family:TwitterChirp;font-size:13px;line-height:20px;margin:auto;text-decoration:none}.xp-quote-count:before{content:"Q ";font-size:16px;vertical-align:bottom}.xp-filtered{align-self:center;color:#b8babd;font-family:TwitterChirp;font-size:15px;margin-left:4px}#xp-ui-root{backdrop-filter:blur(6px);border:0;height:100%;left:0;position:fixed;top:0;width:100%}.xp-tag{display:none}.xp-draftjs-vowel-replacer{float:right}.xp-draftjs-vowel-replacer label{color:gray}',{});var r="webpackChunk_twitter_responsive_web",n={ID:"32pL5BWe9WKeSK1MoPvFQQ",Features:"&features=%7B%22hidden_profile_subscriptions_enabled%22%3Atrue%2C%22profile_label_improvements_pcf_label_in_post_enabled%22%3Atrue%2C%22rweb_tipjar_consumption_enabled%22%3Atrue%2C%22responsive_web_graphql_exclude_directive_enabled%22%3Atrue%2C%22verified_phone_label_enabled%22%3Afalse%2C%22subscriptions_verification_info_is_identity_verified_enabled%22%3Atrue%2C%22subscriptions_verification_info_verified_since_enabled%22%3Atrue%2C%22highlights_tweets_tab_ui_enabled%22%3Atrue%2C%22responsive_web_twitter_article_notes_tab_enabled%22%3Atrue%2C%22subscriptions_feature_can_gift_premium%22%3Atrue%2C%22creator_subscriptions_tweet_preview_api_enabled%22%3Atrue%2C%22responsive_web_graphql_skip_user_profile_image_extensions_enabled%22%3Afalse%2C%22responsive_web_graphql_timeline_navigation_enabled%22%3Atrue%7D&fieldToggles=%7B%22withAuxiliaryUserLabels%22%3Afalse%7D"},o={ID:"o5eNLkJb03ayTQa97Cpp7w",Features:"&features=%7B%22profile_label_improvements_pcf_label_in_post_enabled%22%3Atrue%2C%22rweb_tipjar_consumption_enabled%22%3Atrue%2C%22responsive_web_graphql_exclude_directive_enabled%22%3Atrue%2C%22verified_phone_label_enabled%22%3Afalse%2C%22creator_subscriptions_tweet_preview_api_enabled%22%3Atrue%2C%22responsive_web_graphql_timeline_navigation_enabled%22%3Atrue%2C%22responsive_web_graphql_skip_user_profile_image_extensions_enabled%22%3Afalse%2C%22premium_content_api_read_enabled%22%3Afalse%2C%22communities_web_enable_tweet_community_results_fetch%22%3Atrue%2C%22c9s_tweet_anatomy_moderator_badge_enabled%22%3Atrue%2C%22responsive_web_grok_analyze_button_fetch_trends_enabled%22%3Afalse%2C%22responsive_web_grok_analyze_post_followups_enabled%22%3Atrue%2C%22responsive_web_jetfuel_frame%22%3Afalse%2C%22responsive_web_grok_share_attachment_enabled%22%3Atrue%2C%22articles_preview_enabled%22%3Atrue%2C%22responsive_web_edit_tweet_api_enabled%22%3Atrue%2C%22graphql_is_translatable_rweb_tweet_is_translatable_enabled%22%3Atrue%2C%22view_counts_everywhere_api_enabled%22%3Atrue%2C%22longform_notetweets_consumption_enabled%22%3Atrue%2C%22responsive_web_twitter_article_tweet_consumption_enabled%22%3Atrue%2C%22tweet_awards_web_tipping_enabled%22%3Afalse%2C%22responsive_web_grok_analysis_button_from_backend%22%3Atrue%2C%22creator_subscriptions_quote_tweet_preview_enabled%22%3Afalse%2C%22freedom_of_speech_not_reach_fetch_enabled%22%3Atrue%2C%22standardized_nudges_misinfo%22%3Atrue%2C%22tweet_with_visibility_results_prefer_gql_limited_actions_policy_enabled%22%3Atrue%2C%22rweb_video_timestamps_enabled%22%3Atrue%2C%22longform_notetweets_rich_text_read_enabled%22%3Atrue%2C%22longform_notetweets_inline_media_enabled%22%3Atrue%2C%22responsive_web_grok_image_annotation_enabled%22%3Atrue%2C%22responsive_web_enhance_cards_enabled%22%3Afalse%7D"};const i=["%cX+","padding: 0px 2px"];class s{static{this.log=console.log.bind(window,...i)}static{this.warn=console.warn.bind(window,...i)}static{this.error=console.error.bind(window,...i)}}class l{static{this.listeners=new Set}static get(e){return new Promise((t=>{let r=(n,o)=>{e(n,o)&&(t(n),l.listeners.delete(r))};l.listeners.add(r)}))}static getID(e){let t=l.loader?.c[e];return t?Promise.resolve(t):l.get((t=>e==t))}static getString(e,t){let r=r=>{const n=t(r);return n?.toString==("string"==typeof n?String.prototype.toString:String.toString)&&n.toString().includes(e)};if(l.loader?.c){let t=Object.values(l.loader?.c).map((e=>e.exports)).filter(r);return 1!=t.length?(s.warn(`${t.length} results from string search: "${e}"`,t),Promise.reject(t.length)):Promise.resolve(t[0])}return l.get(r)}static getProps(e,...t){let r=r=>{let n=e(r);return!!n&&t.some((e=>n[e]))};if(l.loader?.c){let e=Object.values(l.loader?.c).map((e=>e.exports)).filter(r);return 1!=e.length?(s.warn(`${e.length} results from prop search: "${t}"`,e),Promise.reject(e.length)):Promise.resolve(e[0])}return l.get(r)}}function a(e,t){const[,r]=t;for(const e in r){const t=Number(e),n=r[t];r[t]=(...e)=>{let[r,o,i]=e;try{n.apply(null,e),r.exports instanceof Object&&Object.defineProperty(r.exports,"__xp_module",{get:()=>n});for(let e of[...l.listeners])e(r.exports,t)}catch(e){s.error(e)}finally{i.m[t]=n}},r[t].toString=()=>n.toString()}return e.webpackPush(t)}!function(){let e=Object.defineProperty;Object.defineProperty=function(t,r,n){return(n.get||n.set)&&(n.configurable=!0),e.call(this,t,r,n)}}(),Object.defineProperty(unsafeWindow,r,{set(e){delete unsafeWindow[r],unsafeWindow[r]=e,Object.defineProperty(e,"push",{get:()=>Array.prototype.push,set:t=>{e.webpackPush=t,Object.defineProperty(e,"push",{value:a.bind(this,e)}),e.push([["X+"],{},e=>l.loader=e])}})}});const p=l.getProps((e=>e),"createElement"),c=l.getProps((e=>e),"createRoot"),d=l.getString("link",(e=>e?.e)),u=l.getString("_handleEditorContainerRef",(e=>e?.prototype?.render)),f=l.getProps((e=>e),"undo","redo"),_=l.getProps((e=>e),"createFromText"),h=l.getString("Bearer",(e=>e?.__xp_module)),b=l.getString("tweet:e.tweet",(e=>e?.ZP?.render)),g=l.getString("_getUserScreenNameNode",(e=>e?.Z)),m=l.getString("_useUserHoverCardWrapper",(e=>e?.Z?.prototype?.render)),w=l.getString("isQuotedTweetUnavailable",(e=>e?.Z)),x=l.getString("isSuperFollowing",(e=>e?.Z?.prototype?.render)),y=l.getProps((e=>e?.Z),"ActionLike"),v=l.getString("_viewCountsPublicVisibilityEnabled",(e=>e?.__xp_module)),C=l.getString("joinDate",(e=>e?.Z?.type)),A=l.getString("amountOfTime",(e=>e?.Z)),k=l.getString("_handleCopyVideoAddress",(e=>e?.Z?.prototype?.render)),P=l.get((e=>e?.HWCard)),S=l.getProps((e=>e?.default?.WrappedComponent?.type?.WrappedComponent?.type?.render?.()?.props?.wrappedComponent?.WrappedComponent?.prototype),"_shouldIncludeTweetAppealOption"),E=l.getString("wideMode",(e=>e?.ZP)),j=l.getString("showHasNewItemsIndicator",(e=>e?.ZP));var O=Object.freeze({__proto__:null,extern_ActionBar:y,extern_ActionBarParent:v,extern_ContextMenu:S,extern_DraftJSContentState:_,extern_DraftJSEditor:u,extern_DraftJSEditorState:f,extern_FollowButton:x,extern_JoinDate:C,extern_Link:d,extern_Poll:P,extern_QuotedPost:w,extern_React:p,extern_ReactDOM:c,extern_Sidebar:E,extern_SidebarButton:j,extern_Timestamp:A,extern_Tweet:b,extern_TweetUser:g,extern_UserCard:m,extern_UserData:h,extern_VideoPlayer:k});const T=Symbol("isProxy");var D=Object.freeze({__proto__:null,isProxy:T});function M(e,t,r,n){!function(e,t,r){let n=e?.[t];n instanceof Object&&!n[T]&&Object.defineProperty(e,t,{value:new Proxy(e[t],{apply:r,get:(e,t,r)=>t==T||Reflect.get(e,t,r)})})}(e,t,((e,t,o)=>{if(r){let e={};if(r(t,o,e),void 0!==e.value)return e.value;void 0!==e.args&&(o=e.args)}let i=Reflect.apply(e,t,o);if(n){let e=n(t,o,i);if(Array.isArray(e))return e[0]}return i}))}class W{constructor(e,t){this.pre=[],this.post=[],M(e,t,B.bind(this),F.bind(this))}subscribe(e,t,r){if(r){t.priority=r;for(let n=0;n<e.length;n++){let o=e[n].priority||0;if(r>o)return void e.splice(n,0,t);r==o&&Number.isFinite(r)&&s.warn(`Two patches have the same priority (${r}):`,t,e[n])}}e.push(t)}}function B(e,t,r){for(let n in this.pre)try{if(this.pre[n](e,t,r),r.value)return;r.args&&(t=r.args)}catch(e){s.error("Exception occurred in pre patch:",e,"Patch list:",this.pre),delete this.pre[n]}}function F(e,t,r){for(let n in this.post)try{let o=this.post[n](e,t,r);Array.isArray(o)&&1==o.length&&(r=o[0])}catch(e){s.error("Exception occurred in post patch:",e,"Patch list:",this.post),delete this.post[n]}return[r]}let N,$,Z;function I(e,t,r,n){let o;for(let n=0;n<(r||1/0)&&e?.return&&!(o=t(e));n++)e=e.return;return o||void(n||s.warn("Failed to find prop in tree. Accessor:",t))}function q(e,t,r){return Z(r,(r=>{let n=r(e);return n.style={...n.style[1],...n.style[0]},N.createElement("a",n,t)}))}p.then((e=>N=e)),c.then((e=>$=e)),d.then((e=>Z=e.e));const U=X(b,(e=>e.ZP.render({}).props.children.type.prototype),"render"),R=X(g,(e=>e.Z.prototype),"render"),V=X(m,(e=>e.Z.prototype),"render"),L=X(E,(e=>e),"ZP"),z=X(w,(e=>e),"Z"),G=X(u,(e=>e.prototype),"render");async function X(e,t,r){return new W(t(await e),r)}R.then((e=>e.subscribe(e.post,(e=>{e.props.tweet=I(e._reactInternals,(e=>e.stateNode?.props?.tweet))}),1/0)));var H=Object.freeze({__proto__:null,DraftJSEditorPatch:G,QuotedPostPatch:z,SidebarPatch:L,TweetPatch:U,TweetUserPatch:R,UserCardPatch:V});let J=[],Q=[];function K(){GM.setValue("xp-follow-list",J.join("\n"));try{Q.forEach((e=>e()))}catch(e){s.warn("Error while running follow list change callback:",e)}}GM.getValue("xp-follow-list").then((e=>{e&&(J=e.split("\n").filter((e=>0!=e.trim().length)))})),x.then((e=>{M(e.Z.prototype,"render",void 0,((e,t,r)=>{let n=r.props.onFollow,o=r.props.onUnfollow;r.props.onFollow=function(){return-1==J.indexOf(r.props.name)&&(J.push(r.props.name),K()),n.apply(this,arguments)},r.props.onUnfollow=function(){let e=J.indexOf(r.props.name);return-1!=e&&(J.splice(e,1),K()),o.apply(this,arguments)}}))}));let Y,ee={};function te(e,t){ee[e]=t}function re(e,...t){Y.contentWindow.postMessage([e,...t],"*")}window.addEventListener("message",(e=>{if("https://local.host:3000"!=e.origin&&"https://reino08.github.io"!=e.origin)return;if(!Array.isArray(e.data)||e.data.length<1)return;let[t,...r]=e.data;ee[t]?.(...r)}));let ne=[];function oe(e){const t=[];return[e.split("\n").map((e=>e.trim())).filter((e=>e&&!e.startsWith("#"))).map((e=>"/"!=e.charAt(0)?[e.charAt(0),e.substring(1)]:["",e])).map((([e,t])=>[e,t.split("#")[0].trim(),t.split("#").slice(1).join("#").trim()])).map((([e,r,n])=>{let o;try{o=new RegExp(r.substring(r.indexOf("/")+1,r.lastIndexOf("/")),r.substring(r.lastIndexOf("/")+1))}catch(e){t.push(e)}return[e,o,n]})).filter((([,e])=>e)),t]}GM.getValue("xp-filters").then((e=>{let t,r=e;r&&([ne,t]=oe(r)),te("filters.get",(()=>{re("filters.set",r),t&&re("filters.compiled",t)}))})),te("filters.set",(e=>{let t;GM.setValue("xp-filters",e),[ne,t]=oe(e),re("filters.compiled",t)})),U.then((e=>e.subscribe(e.pre,((e,t,r)=>{e.filterChecked||(e.filterChecked=!0,e.filterReason=function(e){if(e.user.following||e.user.followed_by)return;for(let[t,r,n]of ne){if(("n"==t||""==t)&&-1!=e.user.name.search(r))return`Name (${n||"Unspecified"})`;if(("b"==t||""==t)&&-1!=e.user.description.search(r))return`Bio (${n||"Unspecified"})`}return null}(e.props.tweet)),e.filterReason&&(r.value=N.createElement("div",{className:"xp-filtered",onClick:()=>(delete e.filterReason,e.forceUpdate())},`Filtered: ${e.filterReason}`))})))),R.then((e=>e.subscribe(e.post,((e,t,r)=>{let n,o=I(e._reactInternals,(e=>e.stateNode?.props?.tweet));if(!o)return r;o.source_name&&(n=o.source_name.replace(/Twitter for/,"").replace(/Twitter Web App/,"Web").replace(/Twitter Web Client/,"Web Client").replace(/TweetDeck Web App/,"TweetDeck"));let i=r.props.children.props.children.props.children[1].props;i.children=N.Children.toArray(i.children).concat(q({style:{color:"#b8babd",marginLeft:"4px",fontFamily:"TwitterChirp",fontSize:"15px",lineHeight:"20px",verticalAlign:"middle",textDecoration:"none",minWidth:"content-fit",flex:"1"}},n||"Unknown",o.source_url||"/"))})))),v.then((e=>{let t=e.Z.WrappedComponent.type.WrappedComponent.type,r=t.render;t.render=function(){let e=r.apply(this,arguments);return M(e.props.wrappedComponent.WrappedComponent.prototype,"render",void 0,((e,t,r)=>{let n=r.props.children[1].props;n.retweetCount=e.props.tweet.retweet_count,n.quoteCount=e.props.tweet.quote_count})),t.render=r,e}})),y.then((e=>{M(e,"Z",void 0,((e,[t],r)=>{if(t.quoteCount+t.retweetCount==0)return;r.props.children.props.children.splice(2,0,q({className:"xp-quote-count"},t.quoteCount,`/${t.tweetLink}/quotes`))}))})),window.dayjs.extend(window.dayjs_plugin_relativeTime),C.then((e=>{M(e.Z,"type",void 0,((e,t,r)=>{r?.props?.children&&(r.props.children=`Joined ${new Date(t[0].joinDate).toLocaleString()} (${window.dayjs(t[0].joinDate).fromNow()})`)}))}));const ie={a:"а",A:"А",b:"ᖯ",B:"Β",c:"с",C:"Ϲ",d:"ԁ",D:"Ꭰ",e:"е",E:"ⴹ",f:"ẝ",F:"ꓝ",g:"ɡ",G:"Ꮐ",h:"һ",H:"Η",i:"і",I:"Ɩ",j:"ј",J:"Ϳ",k:void 0,K:"К",l:"ӏ",L:"Ꮮ",m:"ⅿ",M:"M",n:"ո",N:"Ν",o:"о",O:"О",p:"р",P:"Ρ",q:"ԛ",Q:"ⵕ",r:"г",R:"ꓣ",s:"ꜱ",S:"Ѕ",t:void 0,T:"Τ",u:"ս",U:"Ս",v:"ᴠ",V:"⋁",w:"ᴡ",W:"Ԝ",x:"х",X:"Χ",y:"у",Y:"Υ",z:"ᴢ",Z:"Ζ"},se=Object.entries(ie).reduce(((e,[t,r])=>(e[r]=t,e)),{}),le=[["B",[[97,122,119834],[65,90,119808]]],["I",[[97,122,119886],[65,90,119860]]],["BI",[[97,122,119938],[65,90,119912]]],["DS",[[97,122,120146],[65,90,120120,[2,7,13,15,16,17,25]]]]];function ae(e,t){if(e||t)return"xp-tag xp-user-"+(e&&t?"mutual":e?"followed":"follower")}function pe(e,t,r,n){let o=Math.abs(r)||0;return t&&1!=o&&(e+="s"),[{className:"xp-userinfo-child",style:{color:r<n?"#FFF":"#71767B"}},`${o} ${e}`]}function ce(e,t){t&&e(t)}function de(e){let t,r=e.props.playerState.tracks.flatMap((e=>e.variants)).filter((e=>"video/mp4"==e.type));for(let e of r)(t?.bitrate||0<e.bitrate)&&(t=e);if(t)return t.src;s.warn("Failed to get download url for video:",e.props.playerState)}G.then((e=>e.subscribe(e.post,((e,t,r)=>{function n(e){let t;if(t=se[e])return t;let r=e.codePointAt(0);if(!r)return e;for(let e of le)for(let[t,n,o]of e[1])if(r>=o&&r<=o+n-t)return String.fromCodePoint(r-o+t);return e}function o(t){e.props.handlePastedText(Array.from(function(){let t=e.props.editorState.getSelection(),r=t.getStartOffset(),n=t.getEndOffset(),o=e.props.editorState.getCurrentContent().getBlockForKey(t.getAnchorKey()).getText();return r==n?"":o.slice(r,n)}()).map(t).join(""),"",e.props.editorState)}r.props.children.unshift(N.createElement("div",{className:"xp-rich-text-editor",onMouseDown:e=>e.preventDefault()},N.createElement("button",{onClick:()=>o((e=>n(e)))},"R"),N.createElement("button",{onClick:()=>{return e=ie,void o((t=>{let r=n(t);return e[r]||r}));var e}},"C"),le.map((([e,t])=>N.createElement("button",{onClick:()=>function(e){o((t=>{let r=n(t).codePointAt(0);if(!r)return t;for(let[t,n,o,i]of e)if(!(r<t||r>n||i&&i.includes(r-t)))return String.fromCodePoint(r+o-t);return t}))}(t)},e)))))}),-100))),A.then((e=>{M(e.Z.prototype,"render",void 0,((e,t,r)=>{r.props.children[1].props.onClick=()=>{let t=prompt("Enter observed time in hours:");if(!t)return;let r=(parseInt(t)-new Date(e.props.timestamp).getUTCHours())%24;r<-12&&(r+=24),r>14&&(r-=24),alert(0==r?"UTC":r>0?`UTC+${r}`:`UTC${r}`)}}))})),R.then((e=>e.subscribe(e.post,((e,t,r)=>{let n=e.props.tweet;if(!n)return s.warn("Missing prop `tweet`",e);let o=n.retweeted_status?.user||n.user;if(!o)return;let i=ae(o.following,o.followed_by);i&&(r.props.children=[N.createElement("span",{className:i}),...N.Children.toArray(r.props.children)])}),-100))),V.then((e=>e.subscribe(e.post,((e,t,r)=>{let n=I(e._reactInternals,(e=>e?.stateNode?.props?.hasOwnProperty("isFollowing")&&e.stateNode.props||void 0),void 0,!0);if(!n)return;let o=ae(n.isFollowing,n.isFollowedBy);o&&r.props.children.props.children.unshift(N.createElement("span",{className:o}))}),-100))),V.then((e=>e.subscribe(e.post,((e,t,r)=>{let n=I(e._reactInternals,(e=>e.pendingProps.user),25,!0);if(!n)return;let o=[N.createElement("span",...pe("like",!0,n.favourites_count,100)),N.createElement("span",...pe("post",!0,n.statuses_count,10)),N.createElement("span",...pe("media",!1,n.media_count,5)),q(...pe("list",!0,-(n.listed_count||0),0),`/${n.screen_name}/lists/memberships`)];r.props.children.props.children.push(N.createElement("div",{className:"xp-userinfo-container"},o))})))),k.then((e=>{M(e.Z.prototype,"render",void 0,((e,t,r)=>{e.state.openContextMenu&&M(r.props,"children",void 0,((t,r,n)=>{let o=n.props.children[1].props,i=[N.createElement(o.children.type,{actionText:"Copy download link",onClick:()=>ce(navigator.clipboard.writeText.bind(navigator.clipboard),de(e)),withBottomBorder:!1}),N.createElement(o.children.type,{actionText:"Open video source",onClick:()=>ce(window.open,de(e)),withBottomBorder:!1})];o.children=N.Children.toArray(o.children).concat(i)}))}))})),S.then((e=>{M(e.default.WrappedComponent.type.WrappedComponent.type.render().props.wrappedComponent.WrappedComponent.prototype,"render",(e=>{M(e,"_getActionItems",void 0,((t,r,n)=>{n[0].push({text:"View community notes",link:"/i/birdwatch/t/"+e.props.tweet.id_str})}))}))})),P.then((e=>{M(e.HWCard.prototype,"render",(e=>{e.props.card.binding_values[T]||(e.props.card.binding_values=new Proxy(e.props.card.binding_values,{get(e,t,r){if(t==T)return!0;let n=Reflect.get(e,t,r);if(!n||"string"!=typeof t||!t.endsWith("_label"))return n;let o=t.substring(0,8)+"count";return new Proxy(n,{get(t,r,n){let i=Reflect.get(t,r,n);return"string_value"!=r?i:`${i} (${e[o]?.string_value||"0"})`}})}}))}))}));let ue=!1;var fe;GM.getValue("xp-draftjs-vowel-replacer").then((e=>{void 0!==e&&(ue=!!e)})),G.then((e=>e.subscribe(e.post,((e,t,r)=>{M(e,"update",((e,[t])=>{if(!ue)return;let r=t._immutable.currentContent.blockMap;const n=r.entries();let o,i;for(;({done:o,value:i}=n.next()),!o;){let[e,t]=i;t=t.set("text",t.text.replace(/[aiueo]/gi,(e=>ie[e]))),r=r.set(e,t)}t._immutable=t._immutable.set("currentContent",t._immutable.currentContent.set("blockMap",r))})),r.props.children.unshift(N.createElement("div",{className:"xp-draftjs-vowel-replacer",title:"Automatically replaces vowels with confusables to bypass word filters."},N.createElement("label",null,"Bypass"),N.createElement("input",{type:"checkbox",defaultChecked:ue,onChange:e=>{return t=e.currentTarget.checked,ue=t,void GM.setValue("xp-draftjs-vowel-replacer",t);var t}})))}),-200))),z.then((e=>e.subscribe(e.post,((e,t,r)=>[[N.createElement("span",{className:"xp-tag xp-quoted-post"}),...N.Children.toArray(r)]]),-100))),function(e){e[e.Loading=0]="Loading",e[e.Succeeded=1]="Succeeded",e[e.Failed=2]="Failed"}(fe||(fe={}));const _e={};for(const[e,t]of Object.entries(O).map((([e,t])=>[e.substring(7),t])))_e[e]=0,t.then((()=>_e[e]=1),(()=>_e[e]=2));function he({user:e,element:t}){return N.useEffect((()=>{t.children[0].click()})),q({},"","/"+e)}let be,ge;te("debug.externs.get",(()=>re("debug.externs.set",_e))),Q.push((()=>{re("follow_list.set",J)})),te("follow_list.get",(()=>{re("follow_list.set",J)})),te("follow_list.open",(e=>{let t=document.createElement("div");$.createRoot(t).render(N.createElement(he,{user:e,element:t}))})),j.then((e=>ge=e.ZP)),L.then((e=>e.subscribe(e.post,((e,t,r)=>{if(!ge)return;if(t[0].xpAdded)return;t[0].xpAdded=!0;let n=r.props.children.props.children;n.splice(n.length-2,0,N.createElement(ge,{"aria-label":"Open X+ Menu",label:"Open Menu",layout:"vertical",rank:0,onClick(e){e.preventDefault(),be.style.display=""},renderIcon:()=>N.createElement("div",{style:{width:"24px",height:"24px",fontSize:"24px",fontFamily:"TwitterChirp",lineHeight:"24px"}},"X+"),withLabel:r.props.children.props.children[0].props.withLabel}))})))),window.addEventListener("load",(()=>{be=GM_addElement(document.body,"iframe",{id:"xp-ui-root",src:"https://reino08.github.io/XPlus"}),be.style.display="none",Y=be,te("menu.hide",(()=>be.style.display="none"))}));let me=[];function we(){GM.setValue("xp-hidden-tabs",me.join("\n"))}function xe(){re("hidden_tabs.set",me.join("\n"))}function ye(e){me=e.split("\n").map((e=>e.trim())).filter((e=>e))}function ve({child:e}){let[t,r]=N.useReducer((e=>e+1),0);return M(e.props,"onClick",((t,[n],o)=>{if(n.ctrlKey&&n.altKey){if(n.preventDefault(),o.value=null,"Open X+ Menu"==e.props["aria-label"])return;me.push(e.props.label),we(),xe(),r()}})),me.includes(e.props.label)?null:e}GM.getValue("xp-hidden-tabs").then((e=>{e&&ye(e),te("hidden_tabs.get",xe),te("hidden_tabs.set",(e=>{ye(e),we()}))})),L.then((e=>e.subscribe(e.post,((e,t,r)=>{const n=r.props.children.props,o=n.children.map((e=>N.createElement(ve,{child:e},null)));n.children=o}),-1e4)));let Ce,Ae=!1;l.getProps((e=>e?.default),"theme").then((e=>{e.default.onThemeChange((e=>{Ae&&(Ae=!1,re("theme.set",Ce=e.colors[e.primaryColorName]))})),te("theme.get",(()=>re("theme.set",Ce))),GM.getValue("xp-theme").then((t=>{setTimeout((()=>{Ae=!0,e.default.setPrimaryColor(t)}),1e3)})),te("theme_picker.data.get",(()=>re("tab.theme_picker.data.set",e.default.theme.colors))),te("theme_picker.current.set",(t=>{Ae=!0,e.default.setPrimaryColor(t),GM.setValue("xp-theme",t)}))}));const ke="https://x.com/i/api/graphql/";let Pe;GM.getValue("xp-trackers").then((e=>{Pe=e||[],te("trackers.get",(()=>re("trackers.set",Pe)))})),te("trackers.set",(e=>GM.setValue("xp-trackers",Pe=e))),h.then((e=>{const t=Object.values(e).filter((e=>"function"==typeof e&&e.toString().includes("Bearer")))[0](!1);let r=document.cookie.substring(document.cookie.indexOf("ct0=")+4),i=r.indexOf(";");-1!=i&&(r=r.substring(0,i));const s={Authorization:t,"X-Csrf-Token":r,credentials:"same-origin"};te("trackers.resolve",(async e=>{let t=await fetch(`${ke}${n.ID}/UserByScreenName?variables=%7B%22screen_name%22%3A%22${e}%22%7D${n.Features}`,{headers:s}),r=(await t.json()).data.user.result.rest_id,i=await fetch(`${ke}${o.ID}/Following?variables=%7B%22userId%22%3A%22${r}%22%2C%22count%22%3A20%2C%22includePromotedContent%22%3Afalse%7D${o.Features}`,{headers:s}),l=await i.text(),a=l.indexOf("screen_name");return-1==a?re("tracker.resolve.fail",!1):(l=l.substring(a+14),-1!=l.indexOf("screen_name")?re("tracker.resolve.fail",!0):void re("tracker.resolved",e,l.substring(0,l.indexOf('"'))))}))}));const Se={symbols:D,externs:O,patches:H,Logger:s,Webpack:l,get React(){return N},get ReactDOM(){return $}};Object.defineProperty(unsafeWindow,Symbol.for("X+"),{configurable:!1,enumerable:!1,writable:!1,value:Se}),function(e){const t=Symbol.for("X+ Addons 0");let r=unsafeWindow[t];if(r)for(const t of r)t(e);else r=unsafeWindow[t]=[];const n=r.push;r.push=function(t){return t(e),n.apply(this,arguments)}}(Se),setTimeout((()=>{document.getElementById("placeholder")&&location.reload()}),1e3);
