// ==UserScript==
// @name        X+
// @namespace   X+
// @match       *://twitter.com/*
// @match       *://x.com/*
// @run-at      document-start
// @require     https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js
// @require     https://cdn.jsdelivr.net/npm/dayjs@1/plugin/relativeTime.js
// @homepageURL https://github.com/reino08/XPlus
// @downloadURL https://reino08.github.io/XPlus/X+.user.js
// @grant       GM.getValue
// @grant       GM_getValue
// @grant       GM.setValue
// @grant       GM_addElement
// @grant       GM.xmlHttpRequest
// @grant       unsafeWindow
// ==/UserScript==
var e=[],t=[];!function(r,n){if(r&&"undefined"!=typeof document){var o,i=!0===n.prepend?"prepend":"append",s=!0===n.singleTag,l="string"==typeof n.container?document.querySelector(n.container):document.getElementsByTagName("head")[0];if(s){var a=e.indexOf(l);-1===a&&(a=e.push(l)-1,t[a]={}),o=t[a]&&t[a][i]?t[a][i]:t[a][i]=p()}else o=p();65279===r.charCodeAt(0)&&(r=r.substring(1)),o.styleSheet?o.styleSheet.cssText+=r:o.appendChild(document.createTextNode(r))}function p(){var e=document.createElement("style");if(e.setAttribute("type","text/css"),n.attributes)for(var t=Object.keys(n.attributes),r=0;r<t.length;r++)e.setAttribute(t[r],n.attributes[t[r]]);var o="prepend"===i?"afterbegin":"beforeend";return l.insertAdjacentElement(o,e),e}}(".xp-userinfo{display:flex;flex-wrap:wrap;gap:4px;width:fit-content}.xp-userinfo>*{background-color:#202327;border:0;border-radius:4px;color:#71767b;font-family:TwitterChirp;font-size:11px;line-height:11px;padding:4px;text-decoration:none}.xp-userinfo>[data-threshold]{color:#fff}.xp-userinfo>a:hover,.xp-userinfo>button:hover{background-color:#36393d}.xp-rich-text-editor{line-height:0px}.xp-rich-text-editor>button{background-color:transparent;border:1px solid #444;font-size:14px;height:16px;margin-right:2px;padding:0 2px}.xp-filtered{align-self:center;color:#b8babd;font-family:TwitterChirp;font-size:15px;margin-left:4px}#xp-ui-root{backdrop-filter:blur(6px);border:0;height:100%;left:0;position:fixed;top:0;width:100%}.xp-tag{display:none}.xp-draftjs-vowel-replacer{float:right}.xp-draftjs-vowel-replacer label{color:gray}.xp-logs{height:calc(100vh - 57px)}.xp-logs .xp-logs-warn{color:orange}.xp-logs .xp-logs-error{color:red}.xp-reply-more{aspect-ratio:1/1;background:#fff;border-radius:1000px;color:#000;font-weight:700;height:34px;line-height:0;margin-left:4px;margin-top:8px;padding:10px;text-align:center}",{});const r=["%cX+","padding: 0px 2px"];var n;!function(e){e[e.Log=0]="Log",e[e.Warn=1]="Warn",e[e.Error=2]="Error"}(n||(n={}));const o=new Set;class i{static{this.log=s(console.log,0)}static{this.warn=s(console.warn,1)}static{this.error=s(console.error,2)}static write(e,t=0){for(const r of o)r(e,t)}}function s(e,t){return(...n)=>{e.call(e,...r,...n),i.write(n.map((e=>"string"!=typeof e?JSON.stringify(e):e)).join(" "),t)}}const l=Symbol("isProxy");var a=Object.freeze({__proto__:null,isProxy:l});function p(e,t,r,n){!function(e,t,r){let n=e?.[t];n instanceof Object&&!n[l]&&Object.defineProperty(e,t,{value:new Proxy(e[t],{apply:r,get:(e,t,r)=>t==l||Reflect.get(e,t,r)})})}(e,t,((e,t,o)=>{if(r){let e={};if(r(t,o,e),void 0!==e.value)return e.value;void 0!==e.args&&(o=e.args)}let i=Reflect.apply(e,t,o);if(n){let e=n(t,o,i);if(Array.isArray(e))return e[0]}return i}))}class c{constructor(e,t){this.pre=[],this.post=[],p(e,t,d.bind(this),u.bind(this))}subscribe(e,t,r){if(r){t.priority=r;for(let n=0;n<e.length;n++){let o=e[n].priority||0;if(r>o)return void e.splice(n,0,t);r==o&&Number.isFinite(r)&&i.warn(`Two patches have the same priority (${r}):`,t,e[n])}}e.push(t)}}function d(e,t,r){for(let n in this.pre)try{if(this.pre[n](e,t,r),r.value)return;r.args&&(t=r.args)}catch(e){i.error("Exception occurred in pre patch:",e,"Patch list:",this.pre),delete this.pre[n]}}function u(e,t,r){for(let n in this.post)try{let o=this.post[n](e,t,r);Array.isArray(o)&&1==o.length&&(r=o[0])}catch(e){i.error("Exception occurred in post patch:",e,"Patch list:",this.post),delete this.post[n]}return[r]}var h=Object.freeze({__proto__:null,Patch:c,patchHalves:p}),f="webpackChunk_twitter_responsive_web";class g{static{this.listeners=new Set}static get(e){return new Promise((t=>{let r=(n,o)=>{e(n,o)&&(t(n),g.listeners.delete(r))};g.listeners.add(r)}))}static getID(e){let t=g.loader?.c[e];return t?Promise.resolve(t):g.get((t=>e==t))}static getString(e,t){let r=r=>{const n=t(r);return n?.toString==("string"==typeof n?String.prototype.toString:String.toString)&&n.toString().includes(e)};if(g.loader?.c){let t=Object.values(g.loader?.c).map((e=>e.exports)).filter(r);return 1!=t.length?(i.warn(`${t.length} results from string search: "${e}"`,t),Promise.reject(t.length)):Promise.resolve(t[0])}return g.get(r)}static getProps(e,...t){let r=r=>{let n=e(r);return!!n&&t.some((e=>n[e]))};if(g.loader?.c){let e=Object.values(g.loader?.c).map((e=>e.exports)).filter(r);return 1!=e.length?(i.warn(`${e.length} results from prop search: "${t}"`,e),Promise.reject(e.length)):Promise.resolve(e[0])}return g.get(r)}}function m(e,t){const[,r]=t;for(const e in r){const t=Number(e),n=r[t];r[t]=(...e)=>{let[r,o,s]=e;try{n.apply(null,e),r.exports instanceof Object&&Object.defineProperty(r.exports,"__xp_module",{get:()=>n});for(let e of[...g.listeners])e(r.exports,t)}catch(e){i.error(e)}finally{s.m[t]=n}},r[t].toString=()=>n.toString()}return e.webpackPush(t)}!function(){let e=Object.defineProperty;Object.defineProperty=function(t,r,n){return(n.get||n.set)&&(n.configurable=!0),e.call(this,t,r,n)}}(),Object.defineProperty(unsafeWindow,f,{set(e){delete unsafeWindow[f],unsafeWindow[f]=e,Object.defineProperty(e,"push",{get:()=>Array.prototype.push,set:t=>{e.webpackPush=t,Object.defineProperty(e,"push",{value:m.bind(this,e)}),e.push([["X+"],{},e=>g.loader=e])}})}});const b=g.getProps((e=>e),"createElement"),y=g.getProps((e=>e),"createRoot"),_=g.getProps((e=>e),"MemoryRouter"),w=g.getProps((e=>e?.Z),"runApplication"),x=g.getString("link",(e=>e?.e)),v=g.getString("_handleEditorContainerRef",(e=>e?.prototype?.render)),S=g.getProps((e=>e),"undo","redo"),P=g.getProps((e=>e),"createFromText"),C=g.getString("Bearer",(e=>e?.__xp_module)),E=g.getProps((e=>e),"S1"),k=g.getString("fetchOneUserByScreenName",(e=>e?.ZP)),A=g.getString("fetchFollowing",(e=>e?.ZP)),O=g.getString("fetchBadgeCount",(e=>e?.Z)),T=g.getString("subscriptions_inapp_grok_analyze",(e=>e?.Z)),Z=g.getString("fetchUserTweets",(e=>e?.Z)),j=g.getString("tweetResultByRestId",(e=>e?.ZP)),R=g.getString("update_profile",(e=>e?.Z)),I=g.getString("right_tweet_header_ad_label",(e=>e?.__xp_module)),M=g.getString("_getUserScreenNameNode",(e=>e?.Z)),N=g.getString("ActiveIcon",(e=>e?.ZP)),W=g.getString("_useUserHoverCardWrapper",(e=>e?.Z?.prototype?.render)),D=g.getString("isQuotedTweetUnavailable",(e=>e?.Z)),B=g.getString("isSuperFollowing",(e=>e?.Z?.prototype?.render)),F=g.getProps((e=>e?.Z),"ActionLike"),$=g.getString("_viewCountsPublicVisibilityEnabled",(e=>e?.__xp_module)),L=g.getString("joinDate",(e=>e?.Z?.type)),U=g.getString("amountOfTime",(e=>e?.Z)),V=g.getString("_handleCopyVideoAddress",(e=>e?.Z?.prototype?.render)),z=g.get((e=>e?.HWCard)),G=g.getProps((e=>e?.default?.WrappedComponent?.type?.WrappedComponent?.type?.render?.()?.props?.wrappedComponent?.WrappedComponent?.prototype),"_shouldIncludeTweetAppealOption"),H=g.getString("wideMode",(e=>e?.ZP)),X=g.getString("showHasNewItemsIndicator",(e=>e?.ZP)),q=g.getString("backButtonType",(e=>e?.ZP)),J=g.getString("_renderForOneColumnLayout",(e=>e?.__xp_module)),K=g.getString("DIRECT_MESSAGES_CONVERSATION",(e=>e?.__xp_module)),Q=g.getString("rweb_sidebar_lower_whats_happening_enabled",(e=>e?.__xp_module)),Y=g.getString("_measureAndAnimate",(e=>e?.Z));var ee=Object.freeze({__proto__:null,extern_APIBadgeCount:O,extern_APIFetchPost:T,extern_APIFetchUser:k,extern_APIFetchUserPosts:Z,extern_APIFollowing:A,extern_APIPostActions:j,extern_APIProfileActions:R,extern_ActionBar:F,extern_ActionBarParent:$,extern_ContextMenu:G,extern_DMMessages:K,extern_DMPage:J,extern_DraftJSContentState:P,extern_DraftJSEditor:v,extern_DraftJSEditorState:S,extern_FollowButton:B,extern_HeartBeat:E,extern_JoinDate:L,extern_Link:x,extern_Poll:z,extern_QuotedPost:D,extern_React:b,extern_ReactDOM:y,extern_ReactNativeAppRegistry:w,extern_ReactRouter:_,extern_ReplyEditor:Y,extern_RightSidebar:Q,extern_Sidebar:H,extern_SidebarButton:X,extern_Timestamp:U,extern_Tweet:I,extern_TweetButton:N,extern_TweetUser:M,extern_UserCard:W,extern_UserData:C,extern_VideoPlayer:V,extern_WindowHeader:q});let te,re,ne,oe;function ie(e,t,r,n){let o;for(let n=0;n<(r||1/0)&&e?.return&&!(o=t(e));n++)e=e.return;return o||void(n||i.warn("Failed to find prop in tree. Accessor:",t))}function se(e,t,r){if(!t.length)return r(e);const[n,...o]=t,i=e.props.children.map(((e,t)=>t==n?se(e,o,r):e));return re.cloneElement(e,{children:i})}function le(e,t,r){return oe(r,(r=>{let n=r(e);return n.style={...n.style[1],...n.style[0]},re.createElement("a",n,t)}))}E.then((e=>p(e,"S1",((e,[t])=>te=t)))),b.then((e=>re=e)),y.then((e=>ne=e)),x.then((e=>oe=e.e));const ae=ge(I,(e=>e.ZP.render({}).props.children.type.prototype),"render"),pe=ge(M,(e=>e.Z.prototype),"render"),ce=ge(W,(e=>e.Z.prototype),"render"),de=ge(H,(e=>e),"ZP"),ue=ge(D,(e=>e),"Z"),he=ge(v,(e=>e.prototype),"render"),fe=ge(w,(e=>e.Z),"runApplication");async function ge(e,t,r){return new c(t(await e),r)}pe.then((e=>e.subscribe(e.post,(e=>{e.props.tweet=ie(e._reactInternals,(e=>e.stateNode?.props?.tweet))}),1/0)));var me=Object.freeze({__proto__:null,DraftJSEditorPatch:he,QuotedPostPatch:ue,RunApplicationPatch:fe,SidebarPatch:de,TweetPatch:ae,TweetUserPatch:pe,UserCardPatch:ce});const be={},ye=Symbol("Prefix"),_e=Symbol("Listeners"),we=Symbol("Deactivated");class xe{constructor(e=""){return this[_e]=new Map,e="-"==(e=(e+="-").replace(/-{2,}/g,"-"))?"":e,this[ye]=e,this[we]=!0,new Proxy(this,{get(e,t){if("string"==typeof t){const r=e.#e(t);let n=be[r];if(n)return n;if(n=GM_getValue(r),void 0!==n)return be[r]=n}return Reflect.get(e,t)},set(e,t,r){if(e.hasOwnProperty(we)||"symbol"==typeof t)return Reflect.set(e,t,r);const n=e.#e(t);return GM.setValue(n,be[n]=r),e[_e].get(t)?.forEach((e=>e(t,r))),!0}})}#e(e){return this[ye]+e.replace(/_/g,"-")}save(e){const t=this.#e(e);GM.setValue(t,be[t])}subscribe(e,t){const r=this[_e];r.has(e)?r.get(e).push(t):r.set(e,[t])}static new(e=""){const t=new this(e);return delete t[we],t}}const ve=class extends xe{constructor(...e){super(...e),this.draftjs_vowel_replacer=!1,this.trackers=[],this.hidden_tabs=[],this.hidden_grok=!1,this.hidden_dms=!1,this.profile_preset={url:"",name:"",description:"",location:""}}}.new("xp");let Se;function Pe(){console.log(Se),Se?.forceUpdate()}fe.then((e=>e.subscribe(e.pre,((e,[t,r])=>{p(r.initialProps.routerProps.children.props.children.props.children[1].props.children[3].props.children.type.WrappedComponent.type.render().props.wrappedComponent.type.render().props.wrappedComponent.prototype,"render",void 0,((e,t,r)=>{p(r.props.children.props.children[4].type.WrappedComponent.type.WrappedComponent.prototype,"render",void 0,((t,r,n)=>{Se=e,p(n.props,"children",void 0,((e,t,r)=>{const n=r.props.children;ve.hidden_dms&&(n[2]=null),ve.hidden_grok&&(n[6]=null)}))}))})),ve.subscribe("hidden_dms",Pe),ve.subscribe("hidden_grok",Pe)}))));let Ce,Ee=[],ke=[];function Ae(){GM.setValue("xp-follow-list",Ee.join("\n"));try{ke.forEach((e=>e()))}catch(e){i.warn("Error while running follow list change callback:",e)}}function Oe({res:e}){const{viewer:t}=re.useContext(Ce);return void 0===t?e:re.cloneElement(e,{children:re.cloneElement(e.props.children,{perspective:t,key:t})})}GM.getValue("xp-follow-list").then((e=>{e&&(Ee=e.split("\n").filter((e=>0!=e.trim().length)))})),B.then((e=>{p(e.Z.prototype,"render",void 0,((e,t,r)=>{let n=r.props.onFollow,o=r.props.onUnfollow;r.props.onFollow=function(){return-1==Ee.indexOf(r.props.name)&&(Ee.push(r.props.name),Ae()),n.apply(this,arguments)},r.props.onUnfollow=function(){let e=Ee.indexOf(r.props.name);return-1!=e&&(Ee.splice(e,1),Ae()),o.apply(this,arguments)}}))})),J.then((e=>p(e,"Z",void 0,((e,t,r)=>{Ce||(Ce=re.createContext(void 0));let[n,o]=re.useState(void 0);return[re.createElement(Ce.Provider,{value:{viewer:n,setViewer:o}},r)]})))),q.then((e=>p(e.ZP.prototype,"_renderContent",void 0,((e,t,r)=>{let n,o=r?.props?.children?.[0]?.props?.rightControl?.props?.children;if(o){for(let e of o)if(n=e?.props?.conversationId)break;n&&-1==n.indexOf("-")&&o.unshift(re.createElement(Ce.Consumer,{children:({setViewer:e})=>re.createElement("button",{onClick:()=>{let t=prompt("Enter numerial user ID (empty to clear):");null!==t&&(0==t.length&&(t=void 0),e(t))}},"View As")}))}})))),K.then((e=>{p(e.Z.type,"render",void 0,((e,t,r)=>{p(r.props.wrappedComponent,"type",void 0,((e,t,r)=>[re.createElement(Oe,{res:r})]))}))}));const Te={};_.then((e=>{function t(){const{user_id:t}=e.useParams();if(!t)return;const[r,n]=re.useState();return re.useEffect((()=>{Te.hasOwnProperty(t)?n(Te[t]):k.then((e=>e.ZP(te))).then((e=>e.fetchOneUser({user_id:t}))).then((e=>n(Te[t]=e.entities.users[t].screen_name)))}),[]),r?re.createElement(e.Redirect,{to:"/"+r}):void 0}fe.then((r=>r.subscribe(r.pre,((r,[n,o])=>{o.initialProps.routerProps.children.props.children.props.children[1].props.children[1].push(re.createElement(e.Route,{exact:!0,path:"/i/perma/:user_id"},re.createElement(t)))}))))}));let Ze,je={};function Re(e,t){je[e]=t}function Ie(e,...t){Ze.contentWindow.postMessage([e,...t],"*")}window.addEventListener("message",(e=>{if("https://local.host:3000"!=e.origin&&"https://reino08.github.io"!=e.origin)return;if(!Array.isArray(e.data)||e.data.length<1)return;let[t,...r]=e.data;je[t]?.(...r)}));let Me,Ne=[];function We(e){const t=[];return[e.split("\n").map((e=>e.trim())).filter((e=>e&&!e.startsWith("#"))).map((e=>"/"!=e.charAt(0)?[e.charAt(0),e.substring(1)]:["",e])).map((([e,t])=>[e,t.split("#")[0].trim(),t.split("#").slice(1).join("#").trim()])).map((([e,r,n])=>{let o;try{o=new RegExp(r.substring(r.indexOf("/")+1,r.lastIndexOf("/")),r.substring(r.lastIndexOf("/")+1))}catch(e){t.push(e)}return[e,o,n]})).filter((([,e])=>e)),t]}var De;GM.getValue("xp-filters").then((e=>{let t,r=e;r&&([Ne,t]=We(r)),Re("filters.get",(()=>{Ie("filters.set",r),t&&Ie("filters.compiled",t)}))})),Re("filters.set",(e=>{let t;GM.setValue("xp-filters",e),[Ne,t]=We(e),Ie("filters.compiled",t)})),ae.then((e=>e.subscribe(e.pre,((e,t,r)=>{e.filterChecked||(e.filterChecked=!0,e.filterReason=function(e){if(e.user.following||e.user.followed_by)return;for(let[t,r,n]of Ne){if(("n"==t||""==t)&&-1!=e.user.name.search(r))return`Name (${n||"Unspecified"})`;if(("b"==t||""==t)&&-1!=e.user.description.search(r))return`Bio (${n||"Unspecified"})`}return null}(e.props.tweet)),e.filterReason&&(r.value=re.createElement("div",{className:"xp-filtered",onClick:()=>(delete e.filterReason,e.forceUpdate())},`Filtered: ${e.filterReason}`))})))),pe.then((e=>e.subscribe(e.post,((e,t,r)=>{let n,o=ie(e._reactInternals,(e=>e.stateNode?.props?.tweet));if(!o)return r;o.source_name&&(n=o.source_name.replace(/Twitter for/,"").replace(/Twitter Web App/,"Web").replace(/Twitter Web Client/,"Web Client").replace(/TweetDeck Web App/,"TweetDeck"));let i=r.props.children.props.children.props.children[1].props;i.children=re.Children.toArray(i.children).concat(le({style:{color:"#b8babd",marginLeft:"4px",fontFamily:"TwitterChirp",fontSize:"15px",lineHeight:"20px",verticalAlign:"middle",textDecoration:"none",minWidth:"content-fit",flex:"1"}},n||"Unknown",o.source_url||"/"))})))),N.then((e=>Me=e.ZP)),$.then((e=>{let t=e.Z.WrappedComponent.type.WrappedComponent.type,r=t.render;t.render=function(){let e=r.apply(this,arguments);return p(e.props.wrappedComponent.WrappedComponent.prototype,"render",void 0,((e,t,r)=>{let n=r.props.children[1].props;n.retweetCount=e.props.tweet.retweet_count,n.quoteCount=e.props.tweet.quote_count})),t.render=r,e}})),F.then((e=>{p(e,"Z",void 0,((e,[t],r)=>{if(t.quoteCount+t.retweetCount==0)return;let n=r.props.children.props.children,o=re.createElement(Me,{Icon:()=>re.createElement("div",{style:{fontSize:"16px"}},"Q"),count:t.quoteCount,link:`${t.tweetLink}/quotes`,style:{flex:1},withCount:!0});n.splice(2,0,o)}))})),window.dayjs.extend(window.dayjs_plugin_relativeTime),L.then((e=>{p(e.Z,"type",void 0,((e,t,r)=>{r?.props?.children&&(r.props.children=`Joined ${new Date(t[0].joinDate).toLocaleString()} (${window.dayjs(t[0].joinDate).fromNow()})`)}))})),function(e){e[e.Default=0]="Default",e[e.Spam=1]="Spam",e[e.ReplyAll=2]="ReplyAll",e[e.__LAST=3]="__LAST"}(De||(De={}));let Be=0,Fe=new Set;function $e({children:[e,t]}){const[r,n]=re.useState(Be);return re.useEffect((()=>{const e=e=>n(e);return Fe.add(e),()=>{Fe.delete(e)}}),[]),0!=r&&(t=se(t,[2,1],(e=>re.cloneElement(e,{children:1==r?"Spam":2==r?"Reply All":void 0})))),[e,t,re.createElement("button",{onClick:()=>{Be+=1,Be%=3;for(const e of[...Fe])e(Be)},className:"xp-reply-more"},"+")]}Y.then((e=>{p(e.Z.prototype,"render",void 0,((e,t,r)=>{let n=r?.props?.children?.props?.children?.props;Array.isArray(n?.children)&&n.children[0]&&(n.children=re.createElement($e,{children:n.children}))}))}));let Le=Symbol();async function Ue(e,t,r){const n=(await j).ZP(te),o=t=>Math.round(t/e*100).toString().padStart(3," "),s=await r;i.log(`[${o(1)}%] Sent post 1`);for(let r=2;r<=e;r++)t.status=t.status+".",await n.sendTweet(t,Le),i.log(`[${o(r)}%] Sent post ${r}`);return s}j.then((e=>p(e,"ZP",void 0,((e,t,r)=>{let n;p(r,"sendTweet",((e,[t,r],o)=>{if(r!=Le)if(1==Be){if(n=parseInt(prompt("Amount of times to send the post?")),Number.isNaN(n))return o.value=null}else 2==Be&&(o.value=async function(e){const t=(await T).Z(te),r=(await j).ZP(te),n=e.in_reply_to_status_id;let o,s=0;for(;;){const l=(await t.fetchTweetDetail({focalTweetId:n,cursor:o})).instructions.find((e=>"TimelineAddEntries"==e.type)).entries;console.log(l);const a=l.filter((e=>e.entryId.startsWith("conversationthread"))).flatMap((e=>e.content.items)).map((e=>e.item.itemContent)).filter((e=>"TimelineTweet"==e.itemType)).map((e=>e.tweet_results.result.rest_id)).filter((e=>e));if(!a.length)return i.log(`Finished after ${s} replies`);i.log(`Found ${a.length}${s?" more":""} replies`),s+=a.length;for(const[t,n]of a.map(((e,t)=>[e,t]))){e.in_reply_to_status_id=t;try{await r.sendTweet(e,Le)}catch(e){return void i.error("Failed sending post:",e)}const o=n+1+s-a.length;i.log(`Sent post ${o}/${s}`)}if(o=l.find((e=>e.entryId.startsWith("cursor-bottom")))?.content?.value,!o)return i.warn("No cursor object")}}(t))}),((e,[t,r],o)=>{if(r!=Le&&1==Be)return[Ue(n,t,o)]}))}))));const Ve={a:"а",A:"А",b:"ᖯ",B:"Β",c:"с",C:"Ϲ",d:"ԁ",D:"Ꭰ",e:"е",E:"ⴹ",f:"ẝ",F:"ꓝ",g:"ɡ",G:"Ꮐ",h:"һ",H:"Η",i:"і",I:"Ɩ",j:"ј",J:"Ϳ",k:void 0,K:"К",l:"ӏ",L:"Ꮮ",m:"ⅿ",M:"M",n:"ո",N:"Ν",o:"о",O:"О",p:"р",P:"Ρ",q:"ԛ",Q:"ⵕ",r:"г",R:"ꓣ",s:"ꜱ",S:"Ѕ",t:void 0,T:"Τ",u:"ս",U:"Ս",v:"ᴠ",V:"⋁",w:"ᴡ",W:"Ԝ",x:"х",X:"Χ",y:"у",Y:"Υ",z:"ᴢ",Z:"Ζ"},ze=Object.entries(Ve).reduce(((e,[t,r])=>(e[r]=t,e)),{}),Ge=[["B","Bold Letters",[[97,122,119834],[65,90,119808]]],["I","Italic Letters",[[97,122,119886],[65,90,119860]]],["BI","Bold & Italic Letters",[[97,122,119938],[65,90,119912]]],["DS","Double-Stroke Letters",[[97,122,120146],[65,90,120120,[2,7,13,15,16,17,25]]]]];function He(e,t){if(e||t)return"xp-tag xp-user-"+(e&&t?"mutual":e?"followed":"follower")}function Xe(e,t,r,n){let o=Math.abs(r)||0;return t&&1!=o&&(e+="s"),[r<n?{"data-threshold":!0}:null,`${o} ${e}`]}function qe(e,t){t&&e(t)}function Je(e){let t,r=e.props.playerState.tracks.flatMap((e=>e.variants)).filter((e=>"video/mp4"==e.type));for(let e of r)(t?.bitrate||-1/0)<e.bitrate&&(t=e);if(t)return t.src;i.warn("Failed to get download url for video:",e.props.playerState)}he.then((e=>e.subscribe(e.post,((e,t,r)=>{function n(e){let t;if(t=ze[e])return t;let r=e.codePointAt(0);if(!r)return e;for(let e of Ge)for(let[t,n,o]of e[2])if(r>=o&&r<=o+n-t)return String.fromCodePoint(r-o+t);return e}function o(t){e.props.handlePastedText(Array.from(function(){let t=e.props.editorState.getSelection(),r=t.getStartOffset(),n=t.getEndOffset(),o=e.props.editorState.getCurrentContent().getBlockForKey(t.getAnchorKey()).getText();return r==n?"":o.slice(r,n)}()).map(t).join(""),"",e.props.editorState)}r.props.children.unshift(re.createElement("div",{title:"Select text and press a button to replace letters with lookalikes, bolded/italicized forms, or double-stroke forms.",className:"xp-rich-text-editor",onMouseDown:e=>e.preventDefault()},[re.createElement("button",{title:"Original Characters",onClick:()=>o((e=>n(e)))},"R"),re.createElement("button",{title:"Confusables",onClick:()=>{return e=Ve,void o((t=>{let r=n(t);return e[r]||r}));var e}},"C"),...Ge.map((([e,t,r])=>re.createElement("button",{title:t,onClick:()=>function(e){o((t=>{let r=n(t).codePointAt(0);if(!r)return t;for(let[t,n,o,i]of e)if(!(r<t||r>n||i&&i.includes(r-t)))return String.fromCodePoint(r+o-t);return t}))}(r)},e)))]))}),-100))),U.then((e=>{p(e.Z.prototype,"render",void 0,((e,t,r)=>{r.props.children[1].props.onClick=()=>{let t=prompt("Enter observed time in hours:");if(!t)return;let r=(parseInt(t)-new Date(e.props.timestamp).getUTCHours())%24;r<-12&&(r+=24),r>14&&(r-=24),alert(0==r?"UTC":r>0?`UTC+${r}`:`UTC${r}`)}}))})),pe.then((e=>e.subscribe(e.post,((e,t,r)=>{let n=e.props.tweet;if(!n)return i.warn("Missing prop `tweet`",e);let o=n.retweeted_status?.user||n.user;if(!o)return;let s=He(o.following,o.followed_by);s&&(r.props.children=[re.createElement("span",{className:s}),...re.Children.toArray(r.props.children)])}),-100))),ce.then((e=>e.subscribe(e.post,((e,t,r)=>{let n=ie(e._reactInternals,(e=>e?.stateNode?.props?.hasOwnProperty("isFollowing")&&e.stateNode.props||void 0),void 0,!0);if(!n)return;let o=He(n.isFollowing,n.isFollowedBy);o&&r.props.children.props.children.unshift(re.createElement("span",{className:o}))}),-100))),ce.then((e=>e.subscribe(e.post,((e,t,r)=>{let n=ie(e._reactInternals,(e=>e.pendingProps.user),25,!0);if(!n)return;let o=[re.createElement("span",...Xe("like",!0,n.favourites_count,100)),re.createElement("span",...Xe("post",!0,n.statuses_count,10)),re.createElement("span",...Xe("media",!1,n.media_count,5)),le(...Xe("list",!0,-(n.listed_count||0),0),`/${n.screen_name}/lists/memberships`),le({},`ID: ${n.id_str}`,`/i/perma/${n.id_str}`),re.createElement("button",{onClick:()=>navigator.clipboard.writeText(n.id_str)},"Copy ID")];r.props.children.props.children.push(re.createElement("div",{className:"xp-userinfo"},o))})))),V.then((e=>{p(e.Z.prototype,"render",void 0,((e,t,r)=>{e.state.openContextMenu&&p(r.props,"children",void 0,((t,r,n)=>{let o=n.props.children[1].props,i=[re.createElement(o.children.type,{actionText:"Copy download link",onClick:()=>qe(navigator.clipboard.writeText.bind(navigator.clipboard),Je(e)),withBottomBorder:!1}),re.createElement(o.children.type,{actionText:"Open video source",onClick:()=>qe(window.open,Je(e)),withBottomBorder:!1})];o.children=re.Children.toArray(o.children).concat(i)}))}))})),G.then((e=>{p(e.default.WrappedComponent.type.WrappedComponent.type.render().props.wrappedComponent.WrappedComponent.prototype,"render",(e=>{p(e,"_getActionItems",void 0,((t,r,n)=>{n[0].push({text:"View community notes",link:"/i/birdwatch/t/"+e.props.tweet.id_str})}))}))})),z.then((e=>{p(e.HWCard.prototype,"render",(e=>{e.props.card.binding_values[l]||(e.props.card.binding_values=new Proxy(e.props.card.binding_values,{get(e,t,r){if(t==l)return!0;let n=Reflect.get(e,t,r);if(!n||"string"!=typeof t||!t.endsWith("_label"))return n;let o=t.substring(0,8)+"count";return new Proxy(n,{get(t,r,n){let i=Reflect.get(t,r,n);return"string_value"!=r?i:`${i} (${e[o]?.string_value||"0"})`}})}}))}))})),he.then((e=>e.subscribe(e.post,((e,t,r)=>{p(e,"update",((e,[t])=>{if(!ve.draftjs_vowel_replacer)return;let r=t._immutable.currentContent.blockMap;const n=r.entries();let o,i;for(;({done:o,value:i}=n.next()),!o;){let[e,t]=i;t=t.set("text",t.text.split("").map((e=>ze[e]||e)).join("").split(" ").map((e=>function(e){return e.startsWith("@")||Ke.test(e)}(e)?e:e.replace(/[aiueo]/gi,(e=>Ve[e])))).join(" ")),r=r.set(e,t)}t._immutable=t._immutable.set("currentContent",t._immutable.currentContent.set("blockMap",r))})),r.props.children.unshift(re.createElement("div",{className:"xp-draftjs-vowel-replacer",title:"Automatically replaces vowels with confusables to bypass word filters."},re.createElement("label",null,"Bypass"),re.createElement("input",{type:"checkbox",defaultChecked:ve.draftjs_vowel_replacer,onChange:t=>{ve.draftjs_vowel_replacer=t.currentTarget.checked,e._onBlur(t)}})))}),-200)));const Ke=/[\w]+\.[a-z]{2,}/gi;var Qe;ue.then((e=>e.subscribe(e.post,((e,t,r)=>[[re.createElement("span",{className:"xp-tag xp-quoted-post"}),...re.Children.toArray(r)]]),-100))),_.then((e=>{["MemoryRouter","Route","Router","StaticRouter","Switch"].forEach((t=>e[t].displayName=t))})),function(e){e[e.Loading=0]="Loading",e[e.Succeeded=1]="Succeeded",e[e.Failed=2]="Failed"}(Qe||(Qe={}));const Ye={};for(const[e,t]of Object.entries(ee).map((([e,t])=>[e.substring(7),t])))Ye[e]=0,t.then((()=>Ye[e]=1),(()=>Ye[e]=2));Re("debug.externs.get",(()=>Ie("debug.externs.set",Ye))),Re("debug.externs.open",(e=>i.log(ee["extern_"+e])));const et={};function tt({user:e,element:t}){return re.useEffect((()=>{t.children[0].click()})),le({},"","/"+e)}let rt,nt;function ot(e){const t=[];for(;e.includes("\\");){let r=e.indexOf("\\");t.push(e.substring(0,r)),t.push(e.substring(r,r+2)),e=e.substring(r+2)}return t.concat(e).filter((e=>e)).map((e=>{if("\\"!=e[0])return e;let t=e[1];return"\\"==t?"\\":"h"==t?(r="0123456789abcdef")[Math.floor(Math.random()*r.length)]:void 0;var r})).join("")}g.get((e=>(e?.hasOwnProperty("operationName")&&(et[e.operationName]=e),!1))),Re("debug.graphql.get",(()=>Ie("debug.graphql.set",et))),ke.push((()=>{Ie("follow_list.set",Ee)})),Re("follow_list.get",(()=>{Ie("follow_list.set",Ee)})),Re("follow_list.open",(e=>{let t=document.createElement("div");ne.createRoot(t).render(re.createElement(tt,{user:e,element:t}))})),X.then((e=>nt=e.ZP)),de.then((e=>e.subscribe(e.post,((e,t,r)=>{if(!nt)return;if(t[0].xpAdded)return;t[0].xpAdded=!0;let n=r.props.children.props.children;n.splice(n.length-2,0,re.createElement(nt,{"aria-label":"Open X+ Menu",label:"Open Menu",layout:"vertical",rank:0,onClick(e){e.preventDefault(),rt.style.display=""},renderIcon:()=>re.createElement("div",{style:{width:"24px",height:"24px",fontSize:"24px",fontFamily:"TwitterChirp",lineHeight:"24px"}},"X+"),withLabel:r.props.children.props.children[0].props.withLabel}))})))),window.addEventListener("load",(()=>{rt=GM_addElement(document.body,"iframe",{id:"xp-ui-root",src:"https://reino08.github.io/XPlus"}),rt.style.display="none",Ze=rt,Re("menu.hide",(()=>rt.style.display="none"))})),Re("profile_preset.get",(()=>Ie("profile_preset.set",ve.profile_preset))),Re("profile_preset.set",(e=>ve.profile_preset=e)),Re("profile_preset.apply",(async e=>{ve.profile_preset=e;const t=await(await k).ZP(te).fetchViewer({isDelegate:!1}),r=Object.values(t.normalizedResult.entities.users)[0];let n=r.entities.url.urls.find((e=>e.url==r.url)).expanded_url;n.length>100&&(n=n.substring(n.indexOf("://")+3)),await(await R).Z(te).updateProfile({birthdate_day:r.birthdate.day,birthdate_month:r.birthdate.month,birthdate_year:r.birthdate.year,birthdate_visibility:r.birthdate.visibility,birthdate_year_visibility:r.birthdate.year_visibility,displayNameMaxLength:50,url:ot(e.url)||n,name:ot(e.name)||r.name,description:ot(e.description)||r.description,location:ot(e.location)||r.location})}));let it,st=[];function lt(){const[e,t]=re.useState(st);return re.useEffect((()=>(it=t,()=>it=null)),[]),re.createElement("div",{className:"xp-logs"},e.map((([e,t,r])=>re.createElement("pre",{key:e,className:r==n.Log?"xp-logs-log":r==n.Warn?"xp-logs-warn":r==n.Error?"xp-logs-error":"xp-logs-unknown"},t))))}o.add((function(e,t){st=[[Math.random(),e,t],...st.slice(0,99)],it?.(st)})),Q.then((e=>p(e,"B",void 0,((e,t,r)=>{p(r.type,"type",void 0,((e,t,r)=>[[r.props.children[0],re.createElement(lt)]]))})))),Re("set",((e,t)=>{ve[e]=t})),Re("get",(e=>{Ie("set",e,ve[e])}));let at=[];function pt(){Ie("hidden_tabs.set",at.join("\n"))}function ct(e){at=Array.isArray(e)?e:e.split("\n").map((e=>e.trim())).filter((e=>e))}function dt({child:e}){if(!e?.props)return e;let[t,r]=re.useReducer((e=>e+1),0);return p(e.props,"onClick",((t,[n],o)=>{if(n.ctrlKey&&n.altKey){if(n.preventDefault(),o.value=null,"Open X+ Menu"==e.props["aria-label"])return;at.push(e.props.label),ve.hidden_tabs=at,pt(),r()}})),at.includes(e.props.label)?null:e}ct(ve.hidden_tabs),Re("hidden_tabs.get",pt),Re("hidden_tabs.set",(e=>{ct(e),ve.hidden_tabs=at})),de.then((e=>e.subscribe(e.post,((e,t,r)=>{const n=r.props.children.props,o=n.children.map((e=>re.createElement(dt,{child:e},null)));n.children=o}),-1e4)));let ut,ht=!1;g.getProps((e=>e?.default),"theme").then((e=>{e.default.onThemeChange((e=>{ht&&(ht=!1,Ie("theme.set",ut=e.colors[e.primaryColorName]))})),Re("theme.get",(()=>Ie("theme.set",ut))),GM.getValue("xp-theme").then((t=>{setTimeout((()=>{ht=!0,e.default.setPrimaryColor(t)}),1e3)})),Re("theme_picker.data.get",(()=>Ie("tab.theme_picker.data.set",e.default.theme.colors))),Re("theme_picker.current.set",(t=>{ht=!0,e.default.setPrimaryColor(t),GM.setValue("xp-theme",t)}))})),Re("trackers.get",(()=>Ie("trackers.set",ve.trackers))),Re("trackers.set",(e=>ve.trackers=e)),Re("trackers.resolve",(async e=>{const t=(await(await k).ZP(te).fetchOneUserByScreenName({screen_name:e})).result;let r=JSON.stringify(await(await A).ZP(te).fetchFollowing({userId:t})),n=r.indexOf("screen_name");return-1==n?Ie("tracker.resolve.fail",!1):(r=r.substring(n+14),-1!=r.indexOf("screen_name")?Ie("tracker.resolve.fail",!0):void Ie("tracker.resolved",e,r.substring(0,r.indexOf('"'))))}));const ft={symbols:a,externs:ee,patches:me,Logger:i,Webpack:g,Patch:h,get APIClient(){return te},get React(){return re},get ReactDOM(){return ne}};var gt;function mt(e,t){let r=unsafeWindow[e];if(r)for(const e of r)t(e);else r=unsafeWindow[e]=[];const n=r.push;r.push=function(e){return t(e),n.apply(this,arguments)}}function bt(e,t,r=void 0){let n=null==r?"unnamed addon":"addon "+r;try{t(e)}catch(e){i.error("Failed to load "+n)}i.log("Loaded "+n)}Object.defineProperty(unsafeWindow,Symbol.for("X+"),{configurable:!1,enumerable:!1,writable:!1,value:ft}),gt=ft,mt(Symbol.for("X+ Addons 0"),bt.bind(void 0,gt)),function(e){mt(Symbol.for("X+ Addons 1"),(([t,r])=>bt(e,t,r)))}(ft),setTimeout((()=>{document.getElementById("placeholder")&&location.reload()}),5e3),i.log("Loaded X+ core");
